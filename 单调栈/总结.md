# 题型：单调栈

## 1. 核心思路
维护一个单调递增或递减的栈，用于快速找到每个元素左边或右边第一个比它大/小的元素。

## 2. 模板：

### 2.1 基础模板（找下一个更大元素）
```cpp
stack<int> st;  // 存储下标
st.push(0);     // 初始化第一个元素
for (int i = 1; i < n; i++) {
    if (nums[i] < nums[st.top()]) {
        // 当前元素小于栈顶，保持单调递减
        st.push(i);
    }
    else if (nums[i] == nums[st.top()]) {
        // 当前元素等于栈顶，也入栈
        st.push(i);
    }
    else {
        // 当前元素大于栈顶，处理栈顶元素
        while (!st.empty() && nums[i] > nums[st.top()]) {
            result[st.top()] = i - st.top();  // 计算距离
            st.pop();
        }
        st.push(i);
    }
}
```

### 2.2 找下一个更小元素模板
```cpp
stack<int> st;  // 存储下标
st.push(0);     // 初始化第一个元素
for (int i = 1; i < n; i++) {
    if (nums[i] > nums[st.top()]) {
        // 当前元素大于栈顶，保持单调递增
        st.push(i);
    }
    else if (nums[i] == nums[st.top()]) {
        // 当前元素等于栈顶，也入栈
        st.push(i);
    }
    else {
        // 当前元素小于栈顶，处理栈顶元素
        while (!st.empty() && nums[i] < nums[st.top()]) {
            result[st.top()] = i - st.top();  // 计算距离
            st.pop();
        }
        st.push(i);
    }
}
```

### 2.3 面积计算模板（接雨水类型）
```cpp
stack<int> st;  // 存储下标
st.push(0);     // 初始化第一个元素
for (int i = 1; i < n; i++) {
    if (height[i] < height[st.top()]) {
        // 当前柱子低于栈顶，保持单调递减
        st.push(i);
    }
    else if (height[i] == height[st.top()]) {
        // 当前柱子等于栈顶，也入栈
        st.push(i);
    }
    else {
        // 当前柱子高于栈顶，可以形成凹槽
        while (!st.empty() && height[i] > height[st.top()]) {
            int mid = st.top();  // 凹槽底部
            st.pop();
            if (!st.empty()) {
                int left = st.top();   // 左边界
                int right = i;         // 右边界
                int width = right - left - 1;  // 宽度
                int h = min(height[left], height[right]) - height[mid];  // 高度
                area += width * h;  // 累加面积
            }
        }
        st.push(i);
    }
}
```

## 3. 常见变形
1. **每日温度**（739）- 找右边第一个更大元素，计算天数差
2. **接雨水**（42）- 找左右两边更高的元素，计算凹槽面积
3. **柱状图中最大矩形**（84）- 找左右两边更小的元素，计算矩形面积
4. **下一个更大元素**（496）- 单调栈经典应用，基础模板题
5. **移掉K位数字**（402）- 维护单调递增栈，保持字典序最小

## 4. 关键点
- **栈中存储内容**：通常存储下标，便于计算距离和位置关系
- **单调性维护**：保持栈内元素单调递增或递减
- **处理时机**：遇到破坏单调性的元素时，处理栈顶元素
- **边界处理**：注意栈为空的情况，避免越界访问
- **比较条件**：根据题目需求选择大于或小于的比较

## 5. 时间复杂度
- 每个元素最多入栈一次，出栈一次
- 时间复杂度：O(n)
- 空间复杂度：O(n)

## 6. 解题步骤
1. 确定单调性：递增还是递减
2. 确定存储内容：下标还是值
3. 确定比较条件：大于还是小于
4. 处理栈顶元素：计算结果
5. 当前元素入栈
6. 注意边界情况处理